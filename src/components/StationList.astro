---
/**
 * Station List Component
 *
 * Displays all monitoring stations with their readings.
 */
import type { StationReading } from '../lib/types';

interface Props {
  stations: StationReading[];
  showPm25Warning?: boolean;
}

const { stations, showPm25Warning = true } = Astro.props;

// Count stations with actual PM2.5 data
const stationsWithPm25 = stations.filter(s => s.pm25Concentration !== null);
const coverage = `${stationsWithPm25.length}/${stations.length}`;

function getAqiColor(aqi: number): string {
  if (aqi <= 50) return '#6b8e6b';
  if (aqi <= 100) return '#a3a322';
  if (aqi <= 150) return '#c45a20';
  if (aqi <= 200) return '#b91c1c';
  return '#7f1d1d';
}
---

<section class="station-list">
  <div class="section-header">
    <h2>Monitoring Stations</h2>
    {showPm25Warning && stationsWithPm25.length < stations.length && (
      <span class="coverage-badge" title="Some stations may not have PM2.5 sensors">
        PM2.5 data: {coverage}
      </span>
    )}
  </div>

  <div class="stations-grid">
    {stations.map((station) => (
      <div class:list={['station-card', { 'no-pm25': station.pm25Concentration === null, 'stale': station.isStale }]}>
        <div class="station-header">
          <span class="station-name">{station.area || station.name}</span>
          {station.isStale && <span class="stale-badge">Stale</span>}
        </div>

        <div class="station-aqi" style={`color: ${getAqiColor(station.aqi)}`}>
          {station.aqi}
          <span class="aqi-label">AQI</span>
        </div>

        {station.pm25Concentration !== null ? (
          <div class="station-metrics">
            <div class="metric">
              <span class="metric-value">{station.pm25Concentration.toFixed(1)}</span>
              <span class="metric-label">PM2.5 (µg/m³)</span>
            </div>
            {station.metrics && (
              <div class="metric">
                <span class="metric-value">{station.metrics.cigarettesPerDay.toFixed(1)}</span>
                <span class="metric-label">cigs/day</span>
              </div>
            )}
          </div>
        ) : (
          <div class="no-pm25-notice">
            <span>PM2.5 data unavailable</span>
            {station.dominantPollutant && (
              <span class="dominant-pol">Driven by: {station.dominantPollutant.toUpperCase()}</span>
            )}
          </div>
        )}
      </div>
    ))}
  </div>
</section>

<style>
  .station-list {
    margin-bottom: 2rem;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
  }

  h2 {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 1.25rem;
    font-weight: 500;
    margin: 0;
  }

  .coverage-badge {
    font-size: 0.75rem;
    color: #666;
    background: rgba(0, 0, 0, 0.04);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
  }

  .stations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 1rem;
  }

  .station-card {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 6px;
    padding: 1rem;
    transition: box-shadow 0.15s ease;
  }

  .station-card:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .station-card.no-pm25 {
    opacity: 0.7;
  }

  .station-card.stale {
    border-color: rgba(185, 28, 28, 0.2);
  }

  .station-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.75rem;
  }

  .station-name {
    font-size: 0.8125rem;
    font-weight: 600;
    color: #333;
    line-height: 1.3;
  }

  .stale-badge {
    font-size: 0.625rem;
    color: #b91c1c;
    background: rgba(185, 28, 28, 0.1);
    padding: 0.125rem 0.375rem;
    border-radius: 3px;
    text-transform: uppercase;
  }

  .station-aqi {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 2rem;
    font-weight: 500;
    line-height: 1;
    margin-bottom: 0.5rem;
  }

  .aqi-label {
    font-family: 'Inter', sans-serif;
    font-size: 0.6875rem;
    font-weight: 500;
    color: #999;
    margin-left: 0.25rem;
    text-transform: uppercase;
  }

  .station-metrics {
    display: flex;
    gap: 1rem;
  }

  .metric {
    display: flex;
    flex-direction: column;
  }

  .metric-value {
    font-size: 0.9375rem;
    font-weight: 600;
    color: #333;
  }

  .metric-label {
    font-size: 0.625rem;
    color: #999;
    text-transform: uppercase;
  }

  .no-pm25-notice {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    font-size: 0.75rem;
    color: #999;
    font-style: italic;
  }

  .dominant-pol {
    font-size: 0.6875rem;
    color: #666;
    font-style: normal;
  }

  @media (max-width: 600px) {
    .stations-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .station-card {
      padding: 0.75rem;
    }

    .station-aqi {
      font-size: 1.5rem;
    }
  }
</style>
