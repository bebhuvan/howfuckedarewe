---
/**
 * Health Impact Component
 *
 * Displays cigarette equivalence and life expectancy impacts.
 * Clear about what the numbers mean.
 */
import type { AirQualityMetrics } from '../../lib/types';
import { CIGARETTE_EQUIVALENCE, AQLI, WHO } from '../../lib/constants';

interface Props {
  metrics: AirQualityMetrics;
  population?: number;
}

const { metrics, population } = Astro.props;

// Child multiplier (children absorb ~40% more per kg body weight)
const childCigarettes = metrics.cigarettesPerDay * 1.4;
---

<section class="health-impact">
  <h2>What This Means For You</h2>

  <div class="impact-grid">
    <!-- Cigarette Equivalence -->
    <div class="impact-card cigarettes">
      <div class="impact-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 12H6M6 12L3 12M6 12V9M18 12V15M18 12L21 12"></path>
          <rect x="3" y="9" width="18" height="6" rx="1"></rect>
          <path d="M21 9V6M21 15V18"></path>
        </svg>
      </div>
      <div class="impact-content">
        <div class="impact-value">{metrics.cigarettesPerDay.toFixed(1)}</div>
        <div class="impact-label">cigarettes per day</div>
        <div class="impact-detail">
          Just by breathing. Your child: ~{childCigarettes.toFixed(1)}/day
        </div>
      </div>
    </div>

    <!-- Life Expectancy -->
    <div class="impact-card lifespan">
      <div class="impact-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 6v6l4 2"></path>
        </svg>
      </div>
      <div class="impact-content">
        <div class="impact-value">{metrics.yearsLost.toFixed(1)}</div>
        <div class="impact-label">years lost</div>
        <div class="impact-detail">
          If you breathe this air for your lifetime
        </div>
      </div>
    </div>

    <!-- Daily Equivalent -->
    <div class="impact-card daily">
      <div class="impact-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2"></rect>
          <path d="M16 2v4M8 2v4M3 10h18"></path>
        </svg>
      </div>
      <div class="impact-content">
        <div class="impact-value">{(metrics.hoursLostEquivalentPerDay * 60).toFixed(0)}</div>
        <div class="impact-label">minutes daily equivalent</div>
        <div class="impact-detail">
          Lifetime loss spread per day
        </div>
      </div>
    </div>

    <!-- WHO Violation -->
    <div class="impact-card violation">
      <div class="impact-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </div>
      <div class="impact-content">
        <div class="impact-value">{metrics.whoViolation.toFixed(1)}x</div>
        <div class="impact-label">over WHO guideline</div>
        <div class="impact-detail">
          Safe level: {WHO.PM25_ANNUAL} µg/m³
        </div>
      </div>
    </div>
  </div>

  <div class="methodology-note">
    <details>
      <summary>How these numbers are calculated</summary>
      <div class="note-content">
        <p><strong>Cigarette equivalence:</strong> Based on Berkeley Earth research comparing mortality risk. {CIGARETTE_EQUIVALENCE.PM25_PER_CIGARETTE} µg/m³ PM2.5 ≈ 1 cigarette/day in terms of mortality risk increase. This is illustrative, not chemical equivalence.</p>
        <p><strong>Years lost:</strong> Based on AQLI methodology. Every 10 µg/m³ above WHO guideline ({WHO.PM25_ANNUAL} µg/m³) reduces life expectancy by ~{AQLI.YEARS_LOST_PER_10UG} year with continuous lifetime exposure.</p>
        <p><strong>Daily equivalent:</strong> Lifetime years lost spread across {AQLI.ASSUMED_LIFESPAN} years. This is NOT "you lose X minutes today" - it's a way to make lifetime impact tangible.</p>
        <a href="/methodology">Full methodology & sources →</a>
      </div>
    </details>
  </div>
</section>

<style>
  .health-impact {
    margin-bottom: 2rem;
  }

  h2 {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 1.25rem;
    font-weight: 500;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
  }

  .impact-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .impact-card {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 6px;
    padding: 1rem;
    display: flex;
    gap: 1rem;
  }

  .impact-icon {
    width: 2.5rem;
    height: 2.5rem;
    color: #666;
    flex-shrink: 0;
  }

  .impact-icon svg {
    width: 100%;
    height: 100%;
  }

  .impact-content {
    flex: 1;
    min-width: 0;
  }

  .impact-value {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 1.75rem;
    font-weight: 500;
    line-height: 1;
    color: #b91c1c;
    margin-bottom: 0.25rem;
  }

  .impact-label {
    font-size: 0.8125rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.25rem;
  }

  .impact-detail {
    font-size: 0.75rem;
    color: #666;
  }

  .methodology-note {
    background: rgba(0, 0, 0, 0.02);
    border-radius: 6px;
    padding: 0.75rem 1rem;
  }

  .methodology-note summary {
    font-size: 0.8125rem;
    color: #666;
    cursor: pointer;
  }

  .methodology-note summary:hover {
    color: #333;
  }

  .note-content {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(0, 0, 0, 0.06);
  }

  .note-content p {
    font-size: 0.8125rem;
    color: #666;
    margin-bottom: 0.75rem;
    line-height: 1.6;
  }

  .note-content strong {
    color: #333;
  }

  .note-content a {
    font-size: 0.8125rem;
    color: #b91c1c;
    text-decoration: none;
  }

  .note-content a:hover {
    text-decoration: underline;
  }

  @media (max-width: 600px) {
    .impact-grid {
      grid-template-columns: 1fr;
    }

    .impact-value {
      font-size: 1.5rem;
    }
  }
</style>
