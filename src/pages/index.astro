---
/**
 * All-India Overview Page
 *
 * Shows a grid of all cities with their current air quality.
 * Route: /
 *
 * Data Architecture (v2):
 * - Production: Reads from D1 (populated by ingestion worker hourly)
 * - Fallback: Live WAQI API if D1 is empty (dev mode or first deploy)
 */
import CityLayout from "../layouts/CityLayout.astro";
import DeathCounter from "../components/analysis/DeathCounter.astro";
import CityRankingChart from "../components/charts/CityRankingChart.astro";
import PopulationExposure from "../components/analysis/PopulationExposure.astro";
import NationalHistoricalTrends from "../components/charts/NationalHistoricalTrends.astro";

import { ALL_CITIES, ALL_INDIA, CITIES_BY_POLLUTION } from "../lib/cities";
import { fetchAllCitiesData } from "../lib/waqi";
import { calculateAllMetrics, calculateAveragePm25 } from "../lib/calculations";
import { getLatestCitySnapshots, hasRecentData } from "../lib/db";
import {
	getNationalDailyAggregates,
	getNationalStats,
	getConsecutiveDaysAboveWHO,
	getYearOverYearComparison,
	getLastIngestionTime,
	hasEnoughHistoricalData,
} from "../lib/db-national";
import type { CitySnapshot } from "../lib/types";
import type {
	NationalDailyRow,
	NationalStats,
	YearOverYearData,
} from "../lib/db-national";

// WAQI API token - hardcoded fallback for dev mode (safe, no secrets)
const WAQI_TOKEN =
	import.meta.env.WAQI_API_TOKEN ||
	Astro.locals.runtime?.env?.WAQI_API_TOKEN ||
	"f9c3a63cafeffbe1bae0286e46e8df56c80f87a6";

// Try D1 first in production for fast, reliable data
const db = Astro.locals.runtime?.env?.DB;
let citiesData: CitySnapshot[] = [];

if (db && !import.meta.env.DEV) {
	try {
		if (await hasRecentData(db, 2)) {
			citiesData = await getLatestCitySnapshots(db);
			console.log(`[index] Got ${citiesData.length} cities from D1`);
		}
	} catch (e) {
		console.warn("[index] D1 read failed:", e);
	}
}

// Fallback to live WAQI API (dev mode or D1 empty)
if (citiesData.length === 0 && WAQI_TOKEN) {
	console.log("[index] Falling back to WAQI API...");
	citiesData = await fetchAllCitiesData(ALL_CITIES, WAQI_TOKEN);
	console.log(
		`[index] Got ${citiesData.filter((c) => c.avgPm25 !== null).length} cities with data from API`,
	);
}

// Fetch historical national data from D1 (with graceful fallback)
let nationalDailyData: NationalDailyRow[] = [];
let nationalStats: NationalStats | null = null;
let consecutiveDaysAboveWHO = 0;
let yearOverYear: YearOverYearData | null = null;
let lastIngestionTime: string | null = null;
let hasHistoricalData = false;

// Only try D1 in production (skip in dev to avoid table-not-found errors)
if (!import.meta.env.DEV) {
	try {
		const db = Astro.locals.runtime?.env?.DB;
		if (db && (await hasEnoughHistoricalData(db, 7))) {
			hasHistoricalData = true;
			[
				nationalDailyData,
				nationalStats,
				consecutiveDaysAboveWHO,
				yearOverYear,
				lastIngestionTime,
			] = await Promise.all([
				getNationalDailyAggregates(db, 30),
				getNationalStats(db, 30),
				getConsecutiveDaysAboveWHO(db),
				getYearOverYearComparison(db),
				getLastIngestionTime(db),
			]);
		}
	} catch (e) {
		// D1 not available or no data yet - that's fine, we just won't show historical trends
		console.log("Historical data not available:", e);
	}
}

// DEV MODE: Generate mock data when D1 isn't available (for local preview)
// Remove this block once real data pipeline is running
if (!hasHistoricalData && import.meta.env.DEV) {
	hasHistoricalData = true;
	const now = new Date();
	nationalDailyData = Array.from({ length: 30 }, (_, i) => {
		const date = new Date(now);
		date.setDate(date.getDate() - (29 - i));
		// Simulate realistic Indian winter PM2.5 (40-120 range with some variance)
		const basePm25 = 60 + Math.sin(i / 5) * 25 + (Math.random() - 0.5) * 30;
		return {
			id: i + 1,
			date: date.toISOString().split("T")[0],
			avg_pm25: basePm25,
			weighted_avg_pm25: basePm25 + Math.random() * 10,
			min_pm25: basePm25 - 20,
			max_pm25: basePm25 + 30,
			cities_reporting: 10,
			total_population_covered: 150_000_000,
			cigarettes_equivalent: basePm25 / 22,
			years_lost_per_year: Math.max(0, (basePm25 - 5) / 10) * 0.98,
			who_violation_factor: basePm25 / 5,
			worst_city_id: 1,
			best_city_id: 4,
		};
	});

	const avgPm25 =
		nationalDailyData.reduce(
			(sum, d) => sum + (d.weighted_avg_pm25 || 0),
			0,
		) / nationalDailyData.length;
	const worstDay = nationalDailyData.reduce(
		(max, d) =>
			(d.weighted_avg_pm25 || 0) > (max.weighted_avg_pm25 || 0) ? d : max,
		nationalDailyData[0],
	);

	nationalStats = {
		avgPm25,
		worstDay: {
			date: worstDay.date,
			pm25: worstDay.weighted_avg_pm25 || 0,
		},
		bestDay: {
			date: nationalDailyData[0].date,
			pm25: nationalDailyData[0].weighted_avg_pm25 || 0,
		},
		daysAboveWho: 30, // All days above WHO limit of 5
		totalDays: 30,
		trend: "worsening",
		percentChange: 12.5,
	};

	consecutiveDaysAboveWHO = 47; // Mock streak
	yearOverYear = {
		thisYearAvg: avgPm25,
		lastYearAvg: avgPm25 * 1.08,
		percentChange: -7.4,
		monthlyData: { thisYear: [], lastYear: [] },
	};
	lastIngestionTime = new Date().toISOString();
}

// Calculate national average (from cities with data)
const cityPm25Values = citiesData
	.filter((c) => c.avgPm25 !== null)
	.map((c) => c.avgPm25 as number);

const nationalAvgPm25 = calculateAveragePm25(cityPm25Values);
const nationalMetrics = nationalAvgPm25
	? calculateAllMetrics(nationalAvgPm25)
	: null;

// Find worst and best cities
const citiesWithData = citiesData.filter((c) => c.avgPm25 !== null);
const sortedByPm25 = [...citiesWithData].sort(
	(a, b) => (b.avgPm25 || 0) - (a.avgPm25 || 0),
);
const worstCity = sortedByPm25[0];
const bestCity = sortedByPm25[sortedByPm25.length - 1];

// Ministry of Denial quotes - rotate randomly
const ministryQuotes = [
	{
		text: "The situation is being monitored. The monitoring is proceeding as expected.",
		note: "Status Update, Weekly Brief",
	},
	{
		text: "International standards were not developed keeping Indian conditions in mind.",
		note: "Official Position Paper",
	},
	{
		text: "A committee has been formed to assess the findings of the previous committee.",
		note: "Press Release",
	},
	{
		text: "Residents are advised to remain calm and breathe normally.",
		note: "Public Advisory",
	},
	{
		text: "Data from unofficial sources should not be relied upon.",
		note: "Media Guidelines",
	},
	{
		text: "Comparing our air quality to international standards is unfair given our unique developmental context.",
		note: "Standard Response Template, Form 12-A",
	},
];

// Pick a random quote
const randomQuote =
	ministryQuotes[Math.floor(Math.random() * ministryQuotes.length)];

// Page metadata
const title = "How Fucked Are We — India Air Quality";
const description = nationalMetrics
	? `India's major cities average ${nationalAvgPm25?.toFixed(1)} µg/m³ PM2.5 (${nationalMetrics.whoViolation.toFixed(1)}x WHO limit). ${ALL_INDIA.tagline}`
	: `Air quality across India's major cities. ${ALL_INDIA.tagline}`;

function getColorForPm25(pm25: number | null): string {
	if (pm25 === null) return "#999";
	if (pm25 <= 12) return "#6b8e6b";
	if (pm25 <= 35) return "#a3a322";
	if (pm25 <= 55) return "#c45a20";
	return "#b91c1c";
}
---

<CityLayout title={title} description={description}>
	<!-- Hero Section -->
	<header class="india-hero">
		<div class="hero-hook">
			<span class="hook-number"
				>{
					nationalMetrics
						? nationalMetrics.whoViolation.toFixed(0)
						: "—"
				}×</span
			>
			<span class="hook-text"
				>above what the WHO says is safe to breathe</span
			>
		</div>

		<h1 class="hero-title">Right now, in India</h1>

		<div class="hero-stat-main">
			<span
				class="main-number"
				style={`color: ${nationalMetrics.severity.color}`}
			>
				{nationalAvgPm25.toFixed(0)}
			</span>
			<span class="main-unit">µg/m³ PM2.5</span>
			<span class="main-context">
				Every breath. Every person. {
					(ALL_INDIA.population / 1000000000).toFixed(1)
				} billion lungs.
			</span>
		</div>

		<p class="tagline">
			1.4 billion people. One shared atmosphere. Zero accountability.
		</p>

		{
			nationalMetrics && (
				<div class="hero-stats-row">
					<div class="stat-pill">
						<span class="pill-value">
							{nationalMetrics.cigarettesPerDay.toFixed(1)}
						</span>
						<span class="pill-label">
							cigarettes/day equivalent
						</span>
					</div>
					<div class="stat-pill">
						<span class="pill-value">
							{nationalMetrics.hoursLostEquivalentPerDay.toFixed(
								1,
							)}
							h
						</span>
						<span class="pill-label">
							life lost per person today
						</span>
					</div>
					<div class="stat-pill">
						<span class="pill-value">
							{citiesWithData.length}/{ALL_CITIES.length}
						</span>
						<span class="pill-label">cities reporting</span>
					</div>
				</div>
			)
		}
	</header>

	<!-- Data Source Disclosure -->
	<div class="data-source">
		<div class="source-badge">
			<div class="source-text">
				<strong
					>Live data from <a
						href="https://aqicn.org/map/india/"
						target="_blank"
						rel="noopener">World Air Quality Index</a
					></strong
				>
				<span class="source-note"
					>Updated hourly from CPCB monitoring stations</span
				>
			</div>
		</div>
	</div>

	<!-- Death Counter (National) -->
	<DeathCounter showNational={true} />

	<!-- Population at Risk -->
	<PopulationExposure cities={citiesData} />

	<!-- Historical Trends (only shows if we have enough D1 data) -->
	{
		hasHistoricalData && nationalStats && (
			<NationalHistoricalTrends
				dailyData={nationalDailyData}
				stats={nationalStats}
				consecutiveDaysAboveWHO={consecutiveDaysAboveWHO}
				yearOverYear={yearOverYear}
				lastIngestionTime={lastIngestionTime}
			/>
		)
	}

	<!-- What is AQI Section -->
	<section class="aqi-explainer">
		<h2>The Air You're Breathing (Whether You Like It Or Not)</h2>

		<div class="explainer-grid">
			<div class="explainer-card">
				<h3>What is PM2.5?</h3>
				<p>
					Particles so small (2.5 micrometers) they pass through your
					lungs straight into your bloodstream. They reach your brain.
					Your heart. Every organ. Invisible. Tasteless. Currently
					inside you.
				</p>
				<p class="card-kicker">
					Think of it as unwanted guests who bypass security and make
					themselves at home.
				</p>
			</div>

			<div class="explainer-card">
				<h3>What's "safe" anyway?</h3>
				<div class="safety-scale">
					<div class="scale-item good">
						<span class="scale-value">0-5</span>
						<span class="scale-label">WHO guideline</span>
						<span class="scale-note"
							>What human lungs were designed for</span
						>
					</div>
					<div class="scale-item moderate">
						<span class="scale-value">5-12</span>
						<span class="scale-label">US EPA limit</span>
						<span class="scale-note"
							>"Acceptable" if you're American</span
						>
					</div>
					<div class="scale-item bad">
						<span class="scale-value">12-35</span>
						<span class="scale-label">Unhealthy</span>
						<span class="scale-note"
							>Children & elderly: stay inside</span
						>
					</div>
					<div class="scale-item terrible">
						<span class="scale-value">35+</span>
						<span class="scale-label">Dangerous</span>
						<span class="scale-note"
							>Everyone: reconsider life choices</span
						>
					</div>
				</div>
				<p class="current-context">
					India's cities average <strong
						>{nationalAvgPm25?.toFixed(0)} µg/m³</strong
					>. Our official "acceptable" limit is 40 µg/m³. Convenient,
					no?
				</p>
			</div>

			<div class="explainer-card">
				<h3>Why care? You can't see it.</h3>
				<p>
					Every breath deposits particles your body can never fully
					clear. They trigger inflammation. Age your arteries. Cross
					the blood-brain barrier.
				</p>
				<p>
					The damage is cumulative, silent, and irreversible. By the
					time you notice, years are already gone. Not someday. Now.
					While you're reading this.
				</p>
				<p class="card-kicker">
					You've been breathing it in since you started this page.
				</p>
			</div>

			<div class="explainer-card">
				<h3>Your Options (All Bad)</h3>
				<ul class="action-list">
					<li>
						<strong>Check the AQI daily.</strong> Like checking the weather,
						but for your lifespan.
					</li>
					<li>
						<strong>Buy N95 masks.</strong> Fashion accessory of the apocalypse.
						Cloth masks are just vibes.
					</li>
					<li>
						<strong>Get a HEPA purifier.</strong> Create a tiny bubble
						of first-world air in your bedroom.
					</li>
					<li>
						<strong>Move abroad.</strong> Just kidding. Or are we?
					</li>
					<li>
						<strong>Vote angry.</strong> Stubble burning didn't vote itself
						into policy.
					</li>
				</ul>
			</div>
		</div>
	</section>

	<!-- Worst/Best Cities Banner -->
	{
		worstCity && bestCity && worstCity !== bestCity && (
			<div class="extremes-banner">
				<div class="extreme worst">
					<span class="extreme-label">Most Fucked</span>
					<a href={`/${worstCity.city.slug}`} class="extreme-city">
						{worstCity.city.name}
						<span class="extreme-value">
							{worstCity.avgPm25?.toFixed(1)} µg/m³
						</span>
					</a>
				</div>
				<div class="extreme best">
					<span class="extreme-label">Least Fucked</span>
					<a href={`/${bestCity.city.slug}`} class="extreme-city">
						{bestCity.city.name}
						<span class="extreme-value">
							{bestCity.avgPm25?.toFixed(1)} µg/m³
						</span>
					</a>
				</div>
			</div>
		)
	}

	<!-- City Ranking Chart -->
	<CityRankingChart cities={citiesData} />

	<!-- City Grid -->
	<section class="cities-section">
		<h2>Major Cities</h2>
		<p class="section-intro">
			Click any city for detailed air quality data and health impact
			analysis.
		</p>

		<div class="cities-grid">
			{
				citiesData.map((snapshot) => {
					const hasPm25 = snapshot.avgPm25 !== null;
					const color = getColorForPm25(snapshot.avgPm25);

					return (
						<a
							href={`/${snapshot.city.slug}`}
							class:list={["city-card", { "no-data": !hasPm25 }]}
						>
							<div class="card-header">
								<span class="card-city">
									{snapshot.city.name}
								</span>
								{snapshot.city.localName && (
									<span class="card-local">
										{snapshot.city.localName}
									</span>
								)}
							</div>

							{hasPm25 && snapshot.metrics ? (
								<>
									<div
										class="card-pm25"
										style={`color: ${color}`}
									>
										{snapshot.avgPm25?.toFixed(1)}
										<span class="pm25-unit">µg/m³</span>
									</div>

									<div class="card-metrics">
										<div class="card-metric">
											<span class="metric-value">
												{snapshot.metrics.fuckedIndex.toFixed(
													1,
												)}
											</span>
											<span class="metric-label">
												Fucked Index
											</span>
										</div>
										<div class="card-metric">
											<span class="metric-value">
												{snapshot.metrics.cigarettesPerDay.toFixed(
													1,
												)}
											</span>
											<span class="metric-label">
												cigs/day
											</span>
										</div>
									</div>

									<div
										class="card-status"
										style={`background: ${color}`}
									>
										{snapshot.metrics.severity.label}
									</div>
								</>
							) : (
								<div class="card-no-data">
									<span>Data unavailable</span>
								</div>
							)}

							<div class="card-footer">
								<span class="station-count">
									{snapshot.validStationCount}/
									{snapshot.totalStationCount} stations
								</span>
								<span class="card-arrow">→</span>
							</div>
						</a>
					);
				})
			}
		</div>
	</section>

	<!-- About Section -->
	<section class="about-section">
		<h2>About This Site</h2>
		<div class="about-content">
			<p>
				<strong>howfuckedarewe.in</strong> presents air quality data in terms
				that matter: cigarettes smoked, years of life lost, and whether other
				countries would consider this an emergency.
			</p>
			<p>
				We don't invent numbers. Every metric is sourced from
				peer-reviewed research (Berkeley Earth, AQLI, WHO). We just
				present them without the usual optimistic spin.
			</p>
			<p>
				<a href="/methodology">Read our methodology →</a>
			</p>
		</div>
	</section>

	<!-- Ministry Stamp -->
	<aside class="ministry-stamp">
		<div class="stamp-content">
			<div class="stamp-header">
				Ministry of Denial — All India Office
			</div>
			<div class="stamp-body">
				<p>"{randomQuote.text}"</p>
				<p class="stamp-note">— {randomQuote.note}</p>
			</div>
		</div>
	</aside>

	<div class="last-updated">
		Last updated: {
			lastIngestionTime
				? new Date(lastIngestionTime).toLocaleString("en-IN", {
						timeZone: "Asia/Kolkata",
						dateStyle: "medium",
						timeStyle: "short",
					})
				: "Just now"
		}
	</div>
</CityLayout>

<style>
	.india-hero {
		text-align: center;
		margin-bottom: 2.5rem;
		padding-bottom: 2.5rem;
		border-bottom: 1px solid var(--border);
	}

	.last-updated {
		text-align: center;
		font-size: 0.75rem;
		color: var(--text-light);
		margin-top: 2rem;
		margin-bottom: 1rem;
		opacity: 0.7;
	}

	/* Stats Row - Redesigned */
	.hero-stats-row {
		display: flex;
		justify-content: center;
		flex-wrap: wrap;
		gap: 1.5rem;
		margin-top: 2rem;
		width: 100%;
		max-width: 800px;
	}

	.stat-pill {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		background: #ffffff;
		border: 1px solid rgba(0, 0, 0, 0.1);
		border-radius: 6px;
		padding: 1rem 1.5rem;
		min-width: 140px;
		flex: 1;
		box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
	}

	.stat-pill:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
	}

	.stat-pill::before {
		display: none;
	}

	.pill-value {
		font-family: inherit;
		font-size: 1.25rem;
		font-weight: 600;
		color: #1a1a1a;
		line-height: 1;
		margin-bottom: 0.25rem;
	}

	.pill-label {
		font-size: 0.75rem;
		color: #666;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		text-align: center;
		font-weight: 500;
	}

	.pill-label {
		font-family: inherit; /* Reset font */
		font-size: 0.8125rem;
		color: #666;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		text-align: center;
		font-weight: 500;
	}

	@media (max-width: 768px) {
		.hero-stats-row {
			flex-direction: column;
			gap: 1rem;
		}

		.stat-pill {
			width: 100%;
			flex-direction: row;
			justify-content: space-between;
			padding: 1rem 1.5rem;
			min-height: 80px;
		}

		.pill-value {
			font-size: 2rem;
			margin-bottom: 0;
		}

		.pill-label {
			text-align: right;
			font-size: 0.8125rem;
			max-width: 60%;
		}
	}

	.hero-hook {
		display: inline-flex;
		align-items: baseline;
		gap: 0.5rem;
		background: var(--dark-bg);
		color: white;
		padding: 0.625rem 1.25rem;
		border-radius: 4px;
		margin-bottom: 1.5rem;
	}

	.hook-number {
		font-family: "Playfair Display", Georgia, serif;
		font-size: 2rem;
		font-weight: 600;
		color: #ef4444;
		line-height: 1;
	}

	.hook-text {
		font-size: 0.875rem;
		color: rgba(255, 255, 255, 0.7);
	}

	.hero-title {
		font-family: "Playfair Display", Georgia, serif;
		font-size: 1.5rem;
		font-weight: 400;
		color: var(--text-secondary);
		margin-bottom: 0.75rem;
		letter-spacing: -0.01em;
	}

	.hero-stat-main {
		margin-bottom: 1rem;
	}

	.main-number {
		font-family: "Playfair Display", Georgia, serif;
		font-size: clamp(5rem, 18vw, 9rem);
		font-weight: 500;
		line-height: 1;
		letter-spacing: -0.03em;
		display: block;
	}

	.main-unit {
		font-size: 1rem;
		color: var(--text-light);
		display: block;
		margin-top: 0.25rem;
	}

	.main-context {
		font-size: 0.9375rem;
		color: var(--text-secondary);
		display: block;
		margin-top: 0.75rem;
		font-style: italic;
	}

	.tagline {
		font-size: 1rem;
		color: var(--text-muted);
		margin-bottom: 1.5rem;
		max-width: 500px;
		margin-left: auto;
		margin-right: auto;
	}

	.data-source {
		margin-bottom: 2rem;
		text-align: center;
	}

	.source-badge {
		display: inline-flex;
		padding: 0.625rem 1rem;
		background: var(--bg-paper);
		border: 1px solid var(--border);
		border-radius: 6px;
	}

	.source-text {
		display: flex;
		flex-direction: column;
		font-size: 0.8125rem;
		text-align: center;
	}

	.source-text a {
		color: var(--text);
	}

	.source-note {
		font-size: 0.6875rem;
		color: var(--text-light);
		margin-top: 0.125rem;
	}

	.extremes-banner {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 1rem;
		margin-bottom: 2rem;
	}

	.extreme {
		padding: 1rem;
		border-radius: 6px;
		text-align: center;
	}

	.extreme.worst {
		background: rgba(185, 28, 28, 0.05);
		border: 1px solid rgba(185, 28, 28, 0.2);
	}

	.extreme.best {
		background: rgba(107, 142, 107, 0.05);
		border: 1px solid rgba(107, 142, 107, 0.2);
	}

	.extreme-label {
		display: block;
		font-size: 0.6875rem;
		text-transform: uppercase;
		color: var(--text-light);
		margin-bottom: 0.5rem;
	}

	.extreme-city {
		display: block;
		font-size: 1.125rem;
		font-weight: 600;
		color: var(--text);
		text-decoration: none;
	}

	.extreme-city:hover {
		text-decoration: underline;
	}

	.extreme-value {
		display: block;
		font-size: 0.875rem;
		color: var(--text-muted);
		font-weight: 400;
	}

	.cities-section {
		margin-bottom: 3rem;
	}

	.cities-section h2 {
		font-size: 1.5rem;
		margin-bottom: 0.5rem;
	}

	.section-intro {
		color: var(--text-muted);
		font-size: 0.9375rem;
		margin-bottom: 1.5rem;
	}

	.cities-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
		gap: 1rem;
	}

	.city-card {
		background: white;
		border: 1px solid var(--border);
		border-radius: 8px;
		padding: 1.25rem;
		text-decoration: none;
		color: var(--text);
		transition: all 0.15s ease;
		display: flex;
		flex-direction: column;
	}

	.city-card:hover {
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
		transform: translateY(-2px);
		text-decoration: none;
	}

	.city-card.no-data {
		opacity: 0.6;
	}

	.card-header {
		display: flex;
		justify-content: space-between;
		align-items: baseline;
		margin-bottom: 0.75rem;
	}

	.card-city {
		font-weight: 600;
		font-size: 1.125rem;
	}

	.card-local {
		font-size: 0.8125rem;
		color: var(--text-muted);
	}

	.card-pm25 {
		font-family: "Playfair Display", Georgia, serif;
		font-size: 2.5rem;
		font-weight: 500;
		line-height: 1;
		margin-bottom: 0.5rem;
	}

	.pm25-unit {
		font-family: "Inter", sans-serif;
		font-size: 0.875rem;
		color: var(--text-muted);
		margin-left: 0.25rem;
	}

	.card-metrics {
		display: flex;
		gap: 1.5rem;
		margin-bottom: 0.75rem;
	}

	.card-metric {
		display: flex;
		flex-direction: column;
	}

	.metric-value {
		font-size: 1rem;
		font-weight: 600;
	}

	.metric-label {
		font-size: 0.625rem;
		color: var(--text-light);
		text-transform: uppercase;
	}

	.card-status {
		display: inline-block;
		padding: 0.25rem 0.75rem;
		border-radius: 4px;
		color: white;
		font-size: 0.75rem;
		font-weight: 600;
		text-transform: uppercase;
		margin-bottom: 0.75rem;
		align-self: flex-start;
	}

	.card-no-data {
		flex: 1;
		display: flex;
		align-items: center;
		justify-content: center;
		color: var(--text-light);
		font-style: italic;
		padding: 2rem 0;
	}

	.card-footer {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-top: auto;
		padding-top: 0.75rem;
		border-top: 1px solid var(--border);
	}

	.station-count {
		font-size: 0.75rem;
		color: var(--text-light);
	}

	.card-arrow {
		color: var(--accent);
		font-size: 1rem;
	}

	.about-section {
		background: white;
		border: 1px solid var(--border);
		border-radius: 8px;
		padding: 2rem;
		margin-bottom: 2rem;
	}

	.about-section h2 {
		font-size: 1.25rem;
		margin-bottom: 1rem;
	}

	.about-content p {
		color: var(--text-muted);
		margin-bottom: 0.75rem;
		line-height: 1.7;
	}

	.about-content a {
		font-weight: 500;
	}

	.ministry-stamp {
		padding: 2rem;
		background: var(--bg-paper);
		border: 1px solid var(--border);
		border-left: 3px solid var(--text-light);
		border-radius: 0 8px 8px 0;
		margin-top: 3rem;
	}

	.stamp-content {
		max-width: 560px;
		margin: 0 auto;
		text-align: center;
	}

	.stamp-header {
		font-size: 0.625rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.15em;
		color: var(--text-light);
		margin-bottom: 1rem;
	}

	.stamp-body p {
		font-family: "Playfair Display", Georgia, serif;
		font-size: 1rem;
		color: var(--text-secondary);
		font-style: italic;
		line-height: 1.6;
	}

	.stamp-note {
		font-family: "Inter", sans-serif;
		font-size: 0.6875rem !important;
		font-style: normal !important;
		margin-top: 0.75rem;
		color: var(--text-light) !important;
	}

	/* AQI Explainer Section */
	.aqi-explainer {
		margin-bottom: 2.5rem;
	}

	.aqi-explainer h2 {
		font-size: 1.5rem;
		margin-bottom: 1.25rem;
		text-align: center;
	}

	.explainer-grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: 1rem;
	}

	.explainer-card {
		background: white;
		border: 1px solid var(--border);
		border-radius: 8px;
		padding: 1.25rem;
	}

	.explainer-card h3 {
		font-family: "Inter", sans-serif;
		font-size: 0.9375rem;
		font-weight: 600;
		margin-bottom: 0.75rem;
		color: var(--text);
	}

	.explainer-card p {
		font-size: 0.875rem;
		color: var(--text-muted);
		line-height: 1.6;
		margin-bottom: 0.5rem;
	}

	.explainer-card p:last-child {
		margin-bottom: 0;
	}

	.card-kicker {
		font-style: italic;
		color: var(--text-light);
		font-size: 0.8125rem;
		padding-top: 0.5rem;
		border-top: 1px dashed var(--border);
		margin-top: 0.75rem !important;
	}

	.safety-scale {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
		margin-bottom: 1rem;
	}

	.scale-item {
		display: grid;
		grid-template-columns: 45px 90px 1fr;
		gap: 0.5rem;
		align-items: center;
		padding: 0.5rem;
		border-radius: 4px;
		font-size: 0.8125rem;
	}

	.scale-item.good {
		background: rgba(107, 142, 107, 0.1);
	}
	.scale-item.moderate {
		background: rgba(163, 163, 34, 0.1);
	}
	.scale-item.bad {
		background: rgba(196, 90, 32, 0.1);
	}
	.scale-item.terrible {
		background: #374151;
	}

	.scale-value {
		font-weight: 600;
		color: var(--text);
	}

	.scale-label {
		font-weight: 500;
		color: var(--text-muted);
	}

	.scale-note {
		font-size: 0.75rem;
		color: var(--text-light);
	}

	.current-context {
		font-size: 0.875rem;
		color: var(--text-muted);
		padding-top: 0.75rem;
		border-top: 1px solid var(--border);
	}

	.current-context strong {
		color: var(--accent);
	}

	.action-list {
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.action-list li {
		font-size: 0.875rem;
		color: var(--text-muted);
		padding: 0.5rem 0;
		border-bottom: 1px solid var(--border);
		line-height: 1.5;
	}

	.action-list li:last-child {
		border-bottom: none;
		padding-bottom: 0;
	}

	.action-list strong {
		color: var(--text);
	}

	@media (max-width: 600px) {
		.hero-hook {
			flex-direction: column;
			gap: 0.25rem;
			padding: 0.75rem 1rem;
		}

		.hook-number {
			font-size: 2.5rem;
		}

		.hook-text {
			font-size: 0.75rem;
		}

		.hero-title {
			font-size: 1.25rem;
		}

		.main-context {
			font-size: 0.8125rem;
		}

		.hero-stats-row {
			gap: 0.5rem;
		}

		.stat-pill {
			padding: 0.5rem 0.75rem;
			min-width: 100px;
		}

		.pill-value {
			font-size: 1.25rem;
		}

		.pill-label {
			font-size: 0.625rem;
		}

		.explainer-grid {
			grid-template-columns: 1fr;
		}

		.scale-item {
			grid-template-columns: 40px 1fr;
			font-size: 0.75rem;
		}

		.scale-label {
			display: none;
		}

		.scale-note {
			font-size: 0.6875rem;
		}

		.extremes-banner {
			grid-template-columns: 1fr;
		}

		.cities-grid {
			grid-template-columns: 1fr;
		}

		.card-pm25 {
			font-size: 2rem;
		}
	}
	.main-context {
		display: block;
		font-size: 1rem;
		.impact-text {
			font-size: 1rem;
		}
	}
</style>
